/* ============================================================ */
/* ファイル名 : hw_core_termination.c                           */
/* 機能       : 終了処理                                        */
/* ============================================================ */
#define SECTION_HW

/* ============================================================ */
/* インクルード                                                 */
/* ============================================================ */
/* プロジェクト共通 */
#include "prj_cmn_section.h"
#include "prj_cmn_option.h"
#include "prj_cmn_type.h"
#include "prj_cmn_macro.h"

/* カテゴリ共通 */
#include "hw_cmn_option.h"
#include "hw_cmn_option_pac.h"

/* 個別 */
#include "hw_srv_interrupt.h"
#include "hw_pph_port_pac.h"
#include "hw_pph_intctrl_pac.h"

/* 本体 */
#include "hw_core_termination_pac.h"


/* ============================================================ */
/* マクロ定数定義                                               */
/* ============================================================ */


/* ============================================================ */
/* 型定義                                                       */
/* ============================================================ */


/* ============================================================ */
/* 関数プロトタイプ宣言(static)                                 */
/* ============================================================ */


/* ============================================================ */
/* 変数定義(extern)                                             */
/* ============================================================ */


/* ============================================================ */
/* 変数定義(static)                                             */
/* ============================================================ */
static volatile U4 u4HwCore_Termination_Code;            /* 終了コード */
static volatile U4 u4HwCore_Termination_FreeRunCounter;  /* システム停止時フリーランカウンタ */


/* ============================================================ */
/* const変数定義(extern)                                        */
/* ============================================================ */


/* ============================================================ */
/* const変数定義(static)                                        */
/* ============================================================ */


/* ============================================================ */
/* 関数形式マクロ定義                                           */
/* ============================================================ */


/* ============================================================ */
/* 関数定義                                                     */
/* ============================================================ */

/* ============================================================ */
/* 関数名 : FnVD_HwCore_Termination_kill                        */
/*          停止処理                                            */
/* 引数   : tu4Code  終了コード                                 */
/* 戻り値 : なし                                                */
/* 概要   : 割り込み禁止/全ポート初期化後に無限ループ           */
/* 制約   : 戻らない                                            */
/* ============================================================ */
VD FnVD_HwCore_Termination_kill(U4 tu4Code)
{
  /* PSWレジスタ設定(割り込み禁止) */
  DI();

  /* ポート初期化(システム停止用) */
  FnVD_HwPph_Port_initToKill();

  /* 割り込み制御初期化(システム停止用) */
  FnVD_HwPph_IntCtrl_initToKill();

  /* 終了コード記録 */
  u4HwCore_Termination_Code = tu4Code;

  /* 無限ループ */
  for ( ; ; ) {
    /* システム停止時のフリーランカウンタ処理 */
    u4HwCore_Termination_FreeRunCounter++;  /* ガード不要(ラップアラウンド許容) */
  }
}

